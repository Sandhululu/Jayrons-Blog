<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="movieReviewTitle">Movie Review</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Add Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <!-- You might need auth if you want to restrict access to review pages -->
    <!-- <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script> -->
</head>
<body>
    <header>
        <h1><a href="/Jayrons-Blog/">Jayron's Blog</a></h1>
    </header>
    <main>
        <a class="back-btn" href="/Jayrons-Blog/">‚Üê Back to Blog</a>
        <h2 class="page-title" id="reviewPageTitle">üé¨ Movie Review: Loading...</h2>
    
        <div class="review-container" id="movieReviewContainer">
            <div class="book-cover" id="movieCoverContainer"></div>
            <div class="review-content" id="movieReviewContent">
                <!-- Details and review will be rendered here -->
                 <p id="movieDirector"></p>
                 <p id="movieGenre"></p>
                 <p id="movieWatchedOn"></p>
                 <p id="movieRating" class="post p"></p> <!-- Added classes -->
                 <hr class="divider">
                 <div id="movieReviewText" class="review-text"></div>
            </div>
        </div>

    </main>
    <footer>
        <p>&copy; 2025 Jayron's Blog</p>
    </footer>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD4-qfOjNKQaQVOMpmOWEyAHGnlXXAI6gA",
        authDomain: "jayrons-blog.firebaseapp.com",
        projectId: "jayrons-blog",
      };
      if (!window.firebase.apps.length) {
        window.firebase.initializeApp(firebaseConfig);
      }
      const db = window.firebase.firestore();

      async function loadMovieReview() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        if (!id) {
          document.getElementById('reviewPageTitle').textContent = 'No Movie ID provided.';
          document.getElementById('movieReviewContainer').style.display = 'none';
          return;
        }

        try {
          const docRef = db.collection('posts').doc(id);
          const doc = await docRef.get();

          if (!doc.exists) {
            document.getElementById('reviewPageTitle').textContent = 'Movie not found.';
            document.getElementById('movieReviewContainer').style.display = 'none';
            return;
          }

          const post = doc.data();

          // Update page title and main title
          document.getElementById('movieReviewTitle').textContent = 'üé¨ Movie Review: ' + (post.title || '');
          document.getElementById('reviewPageTitle').textContent = 'üé¨ Movie Review: ' + (post.title || '');

          // Render details
          document.getElementById('movieCoverContainer').innerHTML = ''; // Clear existing content
          if (post.imageUrl) {
            const img = document.createElement('img');
            img.src = post.imageUrl;
            img.alt = post.title || 'Movie poster';
            document.getElementById('movieCoverContainer').appendChild(img);
          }

          document.getElementById('movieDirector').innerHTML = `<strong>üé¨ Director:</strong> ${post.director || 'N/A'}`;
          document.getElementById('movieGenre').innerHTML = `<strong>üé≠ Genre:</strong> ${post.genre || 'N/A'}`;
          document.getElementById('movieWatchedOn').innerHTML = `<strong>üìÖ Watched On:</strong> ${post.watchedOn || 'N/A'}`;
          document.getElementById('movieRating').innerHTML = `<strong>‚≠ê Rating:</strong> ${post.rating || 'N/A'}/10`; // Use simplified rating text

          // Render review text
          const reviewTextDiv = document.getElementById('movieReviewText');
          reviewTextDiv.innerHTML = ''; // Clear existing content
          if (post.description) {
            post.description.split(/\n+/).forEach(paragraph => {
              if (paragraph.trim()) {
                const p = document.createElement('p');
                p.textContent = paragraph.trim();
                reviewTextDiv.appendChild(p);
              }
            });
          }

        } catch (error) {
          console.error('Error fetching movie post:', error);
          document.getElementById('reviewPageTitle').textContent = 'Error loading movie review.';
          document.getElementById('movieReviewContainer').style.display = 'none';
        }
      }

      document.addEventListener('DOMContentLoaded', loadMovieReview);

    </script>
</body>
</html>