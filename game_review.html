<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="gameReviewTitle">Game Review</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <header>
        <h1><a href="/Jayrons-Blog/">Jayron's Blog</a></h1>
    </header>
    <main>
        <a class="back-btn" href="/Jayrons-Blog/">‚Üê Back to Blog</a>
        <h2 class="page-title" id="reviewPageTitle">üéÆ Game Review: Loading...</h2>
    
        <div class="review-container" id="gameReviewContainer">
            <div class="book-cover" id="gameCoverContainer"></div>
            <div class="review-content" id="gameReviewContent">
                <p id="gameDeveloper"></p>
                <p id="gameGenre"></p>
                <p id="gameReleaseDate"></p>
                <p id="gameRating" class="post p"></p>
                <hr class="divider">
                <div id="gameReviewText" class="review-text"></div>
            </div>
        </div>

    </main>
    <footer>
        <p>&copy; 2025 Jayron's Blog</p>
    </footer>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD4-qfOjNKQaQVOMpmOWEyAHGnlXXAI6gA",
        authDomain: "jayrons-blog.firebaseapp.com",
        projectId: "jayrons-blog",
      };
      if (!window.firebase.apps.length) {
        window.firebase.initializeApp(firebaseConfig);
      }
      const db = window.firebase.firestore();

      async function loadGameReview() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        if (!id) {
          document.getElementById('reviewPageTitle').textContent = 'No Game ID provided.';
          document.getElementById('gameReviewContainer').style.display = 'none';
          return;
        }

        try {
          const docRef = db.collection('posts').doc(id);
          const doc = await docRef.get();

          if (!doc.exists) {
            document.getElementById('reviewPageTitle').textContent = 'Game not found.';
            document.getElementById('gameReviewContainer').style.display = 'none';
            return;
          }

          const post = doc.data();

          document.getElementById('gameReviewTitle').textContent = 'üéÆ Game Review: ' + (post.title || '');
          document.getElementById('reviewPageTitle').textContent = 'üéÆ Game Review: ' + (post.title || '');

          document.getElementById('gameCoverContainer').innerHTML = '';
          if (post.imageUrl) {
            const img = document.createElement('img');
            img.src = post.imageUrl;
            img.alt = post.title || 'Game cover';
            document.getElementById('gameCoverContainer').appendChild(img);
          }

          document.getElementById('gameDeveloper').innerHTML = `<strong>üìö Developer:</strong> ${post.developer || 'N/A'}`;
          document.getElementById('gameGenre').innerHTML = `<strong>üé≠ Genre:</strong> ${post.genre || 'N/A'}`;
          document.getElementById('gameReleaseDate').innerHTML = `<strong>‚è≥ Release Date:</strong> ${post.releaseDate || 'N/A'}`;
          document.getElementById('gameRating').innerHTML = `<strong>‚≠ê Rating:</strong> ${post.rating || 'N/A'}/10`;

          const reviewTextDiv = document.getElementById('gameReviewText');
          reviewTextDiv.innerHTML = '';
          if (post.description) {
            post.description.split(/\n+/).forEach(paragraph => {
              if (paragraph.trim()) {
                const p = document.createElement('p');
                p.textContent = paragraph.trim();
                reviewTextDiv.appendChild(p);
              }
            });
          }

        } catch (error) {
          console.error('Error fetching game post:', error);
          document.getElementById('reviewPageTitle').textContent = 'Error loading game review.';
          document.getElementById('gameReviewContainer').style.display = 'none';
        }
      }

      document.addEventListener('DOMContentLoaded', loadGameReview);

    </script>
</body>
</html>