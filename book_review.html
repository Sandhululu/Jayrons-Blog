<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="bookReviewTitle">Book Review</title>
    <link rel="stylesheet" href="../styles.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
    <header>
        <h1><a href="/Jayrons-Blog/">Jayron's Blog</a></h1>
    </header>
    <main>
        <a class="back-btn" href="/Jayrons-Blog/">‚Üê Back to Blog</a>
        <h2 class="page-title" id="reviewPageTitle">üìñ Book Review: Loading...</h2>
    
        <div class="review-container" id="bookReviewContainer">
            <div class="book-cover" id="bookCoverContainer"></div>
            <div class="review-content" id="bookReviewContent">
                <p id="bookAuthor"></p>
                <p id="bookGenre"></p>
                <p id="bookReadingTime"></p>
                <p id="bookTotalWords"></p>
                <p id="bookRating" class="post p"></p>
                <hr class="divider">
                <div id="bookReviewText" class="review-text"></div>
            </div>
        </div>
    </main>
    <footer>
        <p>&copy; 2025 Jayron's Blog</p>
    </footer>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyD4-qfOjNKQaQVOMpmOWEyAHGnlXXAI6gA",
        authDomain: "jayrons-blog.firebaseapp.com",
        projectId: "jayrons-blog",
      };
      if (!window.firebase.apps.length) {
        window.firebase.initializeApp(firebaseConfig);
      }
      const db = window.firebase.firestore();

      async function loadBookReview() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        if (!id) {
          document.getElementById('reviewPageTitle').textContent = 'No Book ID provided.';
          document.getElementById('bookReviewContainer').style.display = 'none';
          return;
        }

        try {
          const docRef = db.collection('posts').doc(id);
          const doc = await docRef.get();

          if (!doc.exists) {
            document.getElementById('reviewPageTitle').textContent = 'Book not found.';
            document.getElementById('bookReviewContainer').style.display = 'none';
            return;
          }

          const post = doc.data();

          document.getElementById('bookReviewTitle').textContent = 'üìñ Book Review: ' + (post.title || '');
          document.getElementById('reviewPageTitle').textContent = 'üìñ Book Review: ' + (post.title || '');

          document.getElementById('bookCoverContainer').innerHTML = '';
          if (post.imageUrl) {
            const img = document.createElement('img');
            img.src = post.imageUrl;
            img.alt = post.title || 'Book cover';
            document.getElementById('bookCoverContainer').appendChild(img);
          }

          document.getElementById('bookAuthor').innerHTML = `<strong>üìö Author:</strong> ${post.author || 'N/A'}`;
          document.getElementById('bookGenre').innerHTML = `<strong>üé≠ Genre:</strong> ${post.genre || 'N/A'}`;
          document.getElementById('bookReadingTime').innerHTML = `<strong>‚è≥ Reading Time:</strong> ${post.readingTime || 'N/A'}`;
          document.getElementById('bookTotalWords').innerHTML = `<strong>üìö Total Words:</strong> ${post.totalWords || 'N/A'}`;
          document.getElementById('bookRating').innerHTML = `<strong>‚≠ê Rating:</strong> ${post.rating || 'N/A'}/10`;

          const reviewTextDiv = document.getElementById('bookReviewText');
          reviewTextDiv.innerHTML = '';
          if (post.description) {
            post.description.split(/\n+/).forEach(paragraph => {
              if (paragraph.trim()) {
                const p = document.createElement('p');
                p.textContent = paragraph.trim();
                reviewTextDiv.appendChild(p);
              }
            });
          }

        } catch (error) {
          console.error('Error fetching book post:', error);
          document.getElementById('reviewPageTitle').textContent = 'Error loading book review.';
          document.getElementById('bookReviewContainer').style.display = 'none';
        }
      }

      document.addEventListener('DOMContentLoaded', loadBookReview);

    </script>
</body>
</html> 